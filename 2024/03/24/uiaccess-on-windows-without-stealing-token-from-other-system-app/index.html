

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/myfavicon.png">
  <link rel="icon" href="/img/myfavicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="fanlumaster">
  <meta name="keywords" content="">
  
    <meta name="description" content="之前在程序里面使用的 enable uiaccess 的方法是参考了这篇博客：https:&#x2F;&#x2F;killtimer0.github.io&#x2F;2023&#x2F;03&#x2F;06&#x2F;UIAccess&#x2F;，体验下来功能是比较正常和稳定的，我将其用在了我的输入法的候选框中，也就是将输入法的候选框给设置为 TOP_MOST。只有一个缺点不能不提，那就是，需要强制使用 admin 权限来运行，这个体验对于普通用户来说其实是不太">
<meta property="og:type" content="article">
<meta property="og:title" content="uiaccess on windows without stealing token from other system app">
<meta property="og:url" content="http://example.com/2024/03/24/uiaccess-on-windows-without-stealing-token-from-other-system-app/index.html">
<meta property="og:site_name" content="Flyan Lu&#39;s Blog">
<meta property="og:description" content="之前在程序里面使用的 enable uiaccess 的方法是参考了这篇博客：https:&#x2F;&#x2F;killtimer0.github.io&#x2F;2023&#x2F;03&#x2F;06&#x2F;UIAccess&#x2F;，体验下来功能是比较正常和稳定的，我将其用在了我的输入法的候选框中，也就是将输入法的候选框给设置为 TOP_MOST。只有一个缺点不能不提，那就是，需要强制使用 admin 权限来运行，这个体验对于普通用户来说其实是不太">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.imgur.com/NJxKJg2.png">
<meta property="article:published_time" content="2024-03-24T12:43:11.000Z">
<meta property="article:modified_time" content="2024-03-25T14:36:49.380Z">
<meta property="article:author" content="fanlumaster">
<meta property="article:tag" content="Windows">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.imgur.com/NJxKJg2.png">
  
  
  <title>uiaccess on windows without stealing token from other system app - Flyan Lu&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.6.0/styles/atom-one-dark.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="/css/custom.css">
<link rel="stylesheet" href="/css/mastodon-icon/iconfont.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Flyan Lu&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/reading/">
                <i class="iconfont icon-book"></i>
                读书
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://i.imgur.com/NJxKJg2.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="uiaccess on windows without stealing token from other system app">
              
            </span>

            
              <div class="mt-3">
  
      
        <span class="post-meta">
          <i class="iconfont icon-date-fill" aria-hidden="true"></i>
          <time datetime="2024-03-24 20:43" pubdate>
            <!-- 2024年3月24日 晚上 -->
            2024-03-24 20:43
          </time>
        </span>
        
          
            <span>-</span>
            <span class="post-meta">
              <i class="iconfont icon-date-fill" aria-hidden="true"></i>
              <time datetime="2024-03-25 22:36" pubdate>
                <!-- 2024年3月25日 晚上 -->
                2024-03-25 22:36
              </time>
            </span>
            
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      4.1k 字
    </span>
    

      
        <span class="post-meta mr-2">
          <i class="iconfont icon-clock-fill"></i>
          
            
              35 分钟
        </span>
        

          
            
</div>

<!-- 自定义的更新时间 -->
<!-- <div class="mt-1">
  
    <p class="note note-info">
      
              本文最后更新于：2024年3月25日 晚上
                  
    </p>
    
</div> -->
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">uiaccess on windows without stealing token from other system app</h1>
            <!-- fanyfull 注释原本的更新时间 start -->
            <!-- 
              <p class="note note-info">
                
                  本文最后更新于：2024年3月25日 晚上
                
              </p>
             -->
            <!-- fanyfull 注释原本的更新时间 end -->
            <div class="markdown-body">
              <p>之前在程序里面使用的 enable uiaccess 的方法是参考了这篇博客：<a
target="_blank" rel="noopener" href="https://killtimer0.github.io/2023/03/06/UIAccess/"
class="uri">https://killtimer0.github.io/2023/03/06/UIAccess/</a>，体验下来功能是比较正常和稳定的，我将其用在了我的输入法的候选框中，也就是将输入法的候选框给设置为
TOP_MOST。只有一个缺点不能不提，那就是，需要强制使用 admin
权限来运行，这个体验对于普通用户来说其实是不太友好的。然后，在之前使用的
ahk 编写的影子输入法中，也有获取 uiaccess 的选项，就去看了一下那个在 ahk
界比较通用流行的脚本，发现其并不是采取从其它进程中窃取 token
的做法，而是利用了之前据说已经失效的方式——在 manifest
中定义相应的属性，</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">assembly</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:schemas-microsoft-com:asm.v1&quot;</span> <span class="hljs-attr">manifestVersion</span>=<span class="hljs-string">&quot;1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">trustInfo</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:schemas-microsoft-com:asm.v3&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">security</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">requestedPrivileges</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:schemas-microsoft-com:asm.v3&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">requestedExecutionLevel</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;asInvoker&quot;</span> <span class="hljs-attr">uiAccess</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">requestedPrivileges</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">security</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">trustInfo</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">assembly</span>&gt;</span><br></code></pre></div></td></tr></table></figure>
<p>这里的 level 使用 asInvoker 就可以了，不需要 requireAdministrator
来获取管理员权限。</p>
<p>但是这里，我在使用 cmake 来编译的时候，又遇到一个问题，就是 cmake
所使用的 MSVC(VS2022) 会默认生成一个 manifest 然后 enbed 到最终的 exe
文件中，导致我这里自己定义的 manifest 属性会发生冲突，也就是会报一个
mt.exe 编译 manifest 不通过的问题。</p>
<figure class="highlight moonscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs moonscript"><span class="hljs-name">C</span>:\Users\fanyfull\AppData\Local\Temp\lnk&#123;<span class="hljs-number">77</span>D5E062<span class="hljs-number">-3</span>BB8<span class="hljs-number">-4</span>A99-BF39 <br><span class="hljs-number">-4480</span>C59E2E06&#125;.tmp : manifest authoring <span class="hljs-built_in">error</span> <span class="hljs-name">c1010001</span>: Values o <br>f attribute <span class="hljs-string">&quot;uiAccess&quot;</span> <span class="hljs-keyword">not</span> equal <span class="hljs-keyword">in</span> different manifest snippets. <br> [<span class="hljs-name">C</span>:\EDisk\CppCodes\IME\IMEByHook\build\fullcpp.vcxproj]<br>  <br>LINK : fatal <span class="hljs-built_in">error</span> <span class="hljs-name">LNK1327</span>: failure during running mt.exe [<span class="hljs-name">C</span>:\ED <br>isk\CppCodes\IME\IMEByHook\build\fullcpp.vcxproj]<br></code></pre></div></td></tr></table></figure>
<p>把这个错误择出来看看，就是这个，</p>
<figure class="highlight applescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs applescript">manifest authoring <span class="hljs-keyword">error</span> c1010001: Values <span class="hljs-keyword">of</span> attribute <span class="hljs-string">&quot;uiAccess&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">equal</span> <span class="hljs-keyword">in</span> different manifest snippets.<br></code></pre></div></td></tr></table></figure>
<p>那么，这个问题应该怎么去解决呢？目前通过 cmake
来解决，我还没有找到方法，那么，只能退而求其次，使用 Visual Studio
本身来进行解决了。</p>
<p>按：下面也可以作为一个单独的完整的内容来阅读，遵从下面的步骤，是可以完整地实现一个窗口真正置顶的功能的。</p>
<h2 id="通用的操作">通用的操作</h2>
<p>实现一个窗口置顶，通常是以下四个步骤：</p>
<ul>
<li>修改 Manifest</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">requestedExecutionLevel</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;asInvoker&quot;</span> <span class="hljs-attr">uiAccess</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span><br></code></pre></div></td></tr></table></figure>
<ul>
<li>修改窗口属性</li>
<li>为程序签名</li>
<li>将程序放在受信任的目录下</li>
</ul>
<h3 id="第一步">第一步</h3>
<p>那就简单使用 VS 来创建一个 demo 来演示一下，</p>
<p><img src="https://i.imgur.com/ZP1ujS9.png" srcset="/img/loading.gif" lazyload /></p>
<p>然后，Project -&gt; Properties -&gt; Configuration Properties -&gt;
Linker -&gt; Manifest File -&gt; UAC Bypass UI Protection</p>
<p><img src="https://i.imgur.com/G0qdX6L.png" srcset="/img/loading.gif" lazyload /></p>
<p><img src="https://i.imgur.com/TiFs14z.png" srcset="/img/loading.gif" lazyload /></p>
<p>按：这里我尝试了微软<a
target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/cpp/build/understanding-manifest-generation-for-c-cpp-programs?view=msvc-170">官方</a>文档里面的一种直接使用
<code>mt.exe</code> 来将 manifest 编译进 exe
文件的方法，发现，是不行的，</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">mt.exe -manifest ./DeclareDPIAware.manifest -outputresource:./build/Debug/fullcpp.exe;1<br></code></pre></div></td></tr></table></figure>
<h3 id="第二步">第二步</h3>
<p>然后，在创建窗口的时候，需要设置一下 <code>WS_EX_TOPMOST</code> 和
<code>HWND_TOPMOST</code>，</p>
<figure class="highlight cpp"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cpp"><span class="hljs-function">BOOL <span class="hljs-title">InitInstance</span><span class="hljs-params">(HINSTANCE hInstance, <span class="hljs-type">int</span> nCmdShow)</span></span><br><span class="hljs-function"></span>&#123;<br>   hInst = hInstance; <span class="hljs-comment">// Store instance handle in our global variable</span><br><br>   HWND hWnd = <span class="hljs-built_in">CreateWindowW</span>(szWindowClass, szTitle, WS_EX_LAYERED | WS_EX_TOPMOST,<br>      CW_USEDEFAULT, <span class="hljs-number">0</span>, CW_USEDEFAULT, <span class="hljs-number">0</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, hInstance, <span class="hljs-literal">nullptr</span>);<br><br>   <span class="hljs-keyword">if</span> (!hWnd)<br>   &#123;<br>      <span class="hljs-keyword">return</span> FALSE;<br>   &#125;<br>   <span class="hljs-built_in">SetWindowPos</span>(hWnd, HWND_TOPMOST, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>, SWP_SHOWWINDOW);<br><br>   <span class="hljs-built_in">ShowWindow</span>(hWnd, nCmdShow);<br>   <span class="hljs-built_in">UpdateWindow</span>(hWnd);<br><br>   <span class="hljs-keyword">return</span> TRUE;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>经过我实际的测试，发现单独设置一个 <code>WS_EX_LAYERED</code>
是不生效的，所以，还需要再额外设置一下 <code>HWND_TOPMOST</code>。</p>
<h3 id="第三步">第三步</h3>
<p>为程序签名。</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">makecert -r -pe -n <span class="hljs-string">&quot;CN=Test Certificate - For Internal Use Only&quot;</span> -ss PrivateCertStore testcert.cer<br></code></pre></div></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">certmgr.exe -add testcert.cer -s -r localMachine root<br></code></pre></div></td></tr></table></figure>
<p>按：这一步如果失败，请切换到管理员模式来执行这个命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">SignTool sign /fd SHA256 /v /s PrivateCertStore /n <span class="hljs-string">&quot;Test Certificate - For Internal Use Only&quot;</span> WindowsProject2.exe<br></code></pre></div></td></tr></table></figure>
<p>按：这里可以把编译好的 exe
文件复制到别的目录进行这个签名的操作。当然，也可以直接在编译输出的原目录中进行操作。</p>
<h3 id="第四步">第四步</h3>
<p>把签好名的可执行文件放入到 <code>C:/Program Files</code>
目录下，随意新建一个目录放进去即可。</p>
<h2
id="迁移我自己的-cmake-程序可能会遇到的问题以及处理方案">迁移我自己的
cmake 程序可能会遇到的问题以及处理方案</h2>
<p>其实也就是一些编译的问题。(这里在创建项目的时候我使用的 solution 和
project 不放在同一目录下)</p>
<ul>
<li>将必要的文件都复制到工程目录中。</li>
<li>LNK2005 问题。这个问题的原因是我自己写的 <code>main.cpp</code> 和 VS
自己生成的一个包含入口函数的程序文件冲突了。</li>
<li>Resource 头文件和 rc
资源文件的问题。注意对原有文件进行替换即可。</li>
</ul>
<p><img src="https://i.imgur.com/9ychKdO.png" srcset="/img/loading.gif" lazyload /></p>
<ul>
<li>链接 sqlite3 的问题。</li>
</ul>
<p><img src="https://i.imgur.com/u73awfu.png" srcset="/img/loading.gif" lazyload /></p>
<p>按：上面这步不确定是否需要处理。</p>
<p>然后，将 sqlite3.dll 文件复制到 exe 文件所在的目录下即可。</p>
<p>然后，再执行上面的四个步骤。最后运行即可得到想要的置顶的效果。</p>
<p>按：2024.03.25 发现，其实不用迁移了。CMake 本身是可以做到的。只需要在
CMakeLists 文件中加上如下的链接脚本即可，</p>
<figure class="highlight txt"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs txt"># 如果是 windows，设置 asInvoker 权限。注意使用 if 需要配合 endif 使用<br>if (CMAKE_SYSTEM_NAME MATCHES &quot;Windows&quot;)<br>    set_target_properties($&#123;PROJECT_NAME&#125; PROPERTIES LINK_FLAGS &quot;/level=&#x27;asInvoker&#x27; /uiAccess=&#x27;true&#x27;&quot; )<br>endif()<br></code></pre></div></td></tr></table></figure>
<hr />
<p>稍微多说一点，窗口置顶有什么好处呢？或者说，有什么具体的应用呢？在我这里，当然是为了输入法的候选框来服务的，输入法的候选框如果被其它窗口遮住，那还得了。</p>
<p>那，有没有其它场景的应用了呢？</p>
<p>有。比如说，桌面水印。如果需要一个全局的水印，那么，这个水印的窗口的优先级肯定是要最高的。</p>
<p>还有呢？其实，键盘可视化的软件也是需要的。不是吗？其它当然也还有适用的场景，这个功能并不是不需要的。</p>
<hr />
<p>1、<a
target="_blank" rel="noopener" href="https://blog.walterlv.com/post/run-desktop-application-above-windows-application.html">让你的程序置顶到比系统界面都更上层，就像任务管理器/放大镜一样绝对置顶</a><br />
2、<a
target="_blank" rel="noopener" href="https://killtimer0.github.io/2023/03/06/UIAccess/">通过System令牌获取UIAccess</a><br />
3、<a target="_blank" rel="noopener" href="https://github.com/killtimer0/uiaccess"
class="uri">https://github.com/killtimer0/uiaccess</a><br />
4、<a target="_blank" rel="noopener" href="https://www.cnblogs.com/pandamohist/p/16908223.html"
class="uri">https://www.cnblogs.com/pandamohist/p/16908223.html</a><br />
5、<a
target="_blank" rel="noopener" href="https://googles.plus/2024/01/25/cmake-dui-windows-cheng-xu-jia-ru-uac-zhi-chi/"
class="uri">https://googles.plus/2024/01/25/cmake-dui-windows-cheng-xu-jia-ru-uac-zhi-chi/</a><br />
6、<a
target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/cpp/build/understanding-manifest-generation-for-c-cpp-programs?view=msvc-170"
class="uri">https://learn.microsoft.com/en-us/cpp/build/understanding-manifest-generation-for-c-cpp-programs?view=msvc-170</a></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Windows/">Windows</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    <b>版权声明：</b> 本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/03/24/Cpp-string-literal-pass-to-char-pointer/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">C++ 字符串字面量作为参数传递给字符指针</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/02/18/A-new-method-to-get-caret-on-Windows/">
                        <span class="hidden-mobile">一种新的获取 Windows 窗口的文本光标的方式</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    
      <script type="text/javascript">
        var disqus_config = function() {
          this.page.url = 'http://example.com/2024/03/24/uiaccess-on-windows-without-stealing-token-from-other-system-app/';
          this.page.identifier = '/2024/03/24/uiaccess-on-windows-without-stealing-token-from-other-system-app/';
        };
        Fluid.utils.loadComments('#disqus_thread', function() {
          var d = document, s = d.createElement('script');
          s.src = '//' + 'https-fanlumaster-github-io' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        });
      </script>
    
    <noscript>Please enable JavaScript to view the comments</noscript>
  </div>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://fanyfull.top/@fanyfull" target="_blank" rel="nofollow noopener"><span>Monster</span></a> <i class="iconfont icon-love"></i> <a href="https://fanyfull.github.io" target="_blank" rel="nofollow noopener"><span>Another</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.2/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        loader: {
          
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-svg.js" ></script>

  










  
<script src="/js/custom.js"></script>



<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
